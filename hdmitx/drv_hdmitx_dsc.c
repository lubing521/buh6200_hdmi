/*
 * Copyright (c) Hisilicon Technologies Co., Ltd. 2019. All rights reserved.
 * Description: hdmi driver dsc pps compute file
 * Author: Hisilicon multimedia interface software group
 * Create: 2019-06-22
 */

#include <linux/kernel.h>
#include <linux/module.h>
#include <linux/init.h>

#include "drv_hdmitx.h"
#include "drv_hdmitx_dsc.h"

#define BPP_FACTOR_16                   16
#define BPP_FACTOR_32                   32
#define BYTES                           8
#define MAX_FINAL_SCALE                 9
#define MAX_SCALE_INCREMENT_INTERVAL    65535

#define NUM_0                   0
#define NUM_1                   1
#define NUM_2                   2
#define NUM_3                   3
#define NUM_4                   4
#define NUM_5                   5
#define NUM_6                   6
#define NUM_7                   7
#define NUM_8                   8
#define NUM_9                   9
#define NUM_10                  10
#define NUM_11                  11
#define NUM_12                  12
#define NUM_13                  13
#define NUM_14                  14
#define NUM_15                  15
#define NUM_16                  16
#define NUM_17                  17
#define NUM_19                  19
#define NUM_20                  20
#define NUM_21                  21
#define NUM_24                  24
#define NUM_23                  23
#define NUM_28                  28
#define NUM_29                  29
#define NUM_31                  31
#define NUM_32                  32
#define NUM_34                  34
#define NUM_37                  37
#define NUM_48                  48
#define NUM_49                  49
#define NUM_61                  61
#define NUM_63                  63
#define NUM_64                  64
#define NUM_96                  96
#define NUM_100                 100
#define NUM_128                 128
#define NUM_160                 160
#define NUM_192                 192
#define NUM_224                 224
#define NUM_240                 240
#define NUM_256                 256
#define NUM_320                 320
#define NUM_512                 512
#define NUM_896                 896
#define NUM_1792                1792
#define NUM_2048                2048
#define NUM_2688                2688
#define NUM_3584                3584
#define NUM_4095                4095
#define NUM_4480                4480
#define NUM_5376                5376
#define NUM_5632                5632
#define NUM_6144                6144
#define NUM_6272                6272
#define NUM_6720                6720
#define NUM_7168                7168
#define NUM_7616                7616
#define NUM_7744                7744
#define NUM_7872                7872
#define NUM_8000                8000
#define NUM_8064                8064
#define NUM_8192                8192
#define NUM_65535               65535

#define CLAMP(x, min, max)      ((x) > (max) ? (max) : ((x) < (min) ? (min) : (x)))
#define MIN(x, y)               ((x) < (y) ? (x) : (y))
#define MAX(x, y)               ((x) > (y) ? (x) : (y))
#define RANGE_CHECK(s, a, b, c) \
    {                                                                         \
        if (((a) < (b)) || ((a) > (c))) {                                     \
            HDMI_ERR("ERROR: %s out of range, between %d and %d\n", s, b, c); \
        }                                                                     \
    }

hi_u8 g_range_bpg_offset_bppmin_444[] = {
    0, -2, -2, -4, -6, -6, -8, -8, -8, -10, -10, -12, -12, -12, -12
};

hi_u8 g_range_bpg_offset_bppmin[] = {
    2, 0, 0, -2, -4, -6, -8, -8, -8, -10, -10, -12, -12, -12, -12
};

hi_u8 g_range_bpg_offset_bppmax[] = {
    10, 8, 6, 4, 2, 0, -2, -4, -6, -8, -10, -10, -12, -12, -12
};

hi_u8 g_range_min_qp_8bpc_444_or_rgb[NUM_15][NUM_37] = {
    { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
      0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
    },
    { 1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
      0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
    },
    { 3,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,
      0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
    },
    { 3,  3,  2,  2,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,
      0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
    },
    { 5,  4,  4,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  2,  1,  1,  1,  1,
      1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0
    },
    { 5,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  2,  1,  1,  1,
      1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0
    },
    { 5,  5,  4,  4,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  1,
      1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0
    },
    { 5,  5,  4,  4,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,
      2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0
    },
    { 5,  5,  4,  4,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,
      2,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  0,  0,  0
    },
    { 6,  5,  5,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,
      3,  3,  3,  3,  3,  3,  3,  2,  2,  1,  1,  1,  1,  1,  1,  0,  0,  0
    },
    { 6,  6,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,
      4,  4,  4,  3,  3,  3,  3,  2,  2,  1,  1,  1,  1,  1,  1,  1,  1,  0
    },
    { 6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  4,  4,
      4,  4,  4,  4,  4,  4,  4,  3,  3,  2,  2,  2,  2,  1,  1,  1,  1,  0
    },
    { 6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5,
      5,  5,  5,  4,  4,  4,  4,  3,  3,  2,  2,  2,  2,  1,  1,  1,  1,  0
    },
    { 9,  9,  9,  9,  8,  8,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,
      7,  6,  6,  5,  5,  5,  5,  4,  4,  3,  3,  3,  3,  2,  2,  1,  1,  1
    },
    { 14, 14, 13, 13, 12, 12, 12, 12, 11, 11, 10, 10, 10, 10, 9,  9,  9,  8,  8,
      8,  7,  7,  7,  7,  6,  6,  5,  5,  5,  5,  4,  4,  4,  3,  3,  3,  3
    }
};

hi_u8 g_range_max_qp_8bpc_444_or_rgb[NUM_15][NUM_37] = {
    { 4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  2,  2,  2,  2,  1,  1,  1,  0,  0,
      0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
    },
    { 6,  6,  5,  5,  4,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  2,  2,  1,  1,
      1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0
    },
    { 8,  7,  7,  6,  5,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  3,  2,  2,  1,
      1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0
    },
    { 8,  8,  7,  7,  6,  6,  6,  6,  6,  6,  6,  6,  5,  5,  5,  4,  3,  3,  2,
      2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0
    },
    { 9,  8,  8,  7,  7,  7,  7,  7,  7,  7,  7,  7,  6,  6,  5,  4,  4,  3,  2,
      2,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  1,  0
    },
    { 9,  8,  8,  8,  7,  7,  7,  7,  7,  7,  7,  7,  6,  6,  6,  5,  4,  4,  3,
      3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1
    },
    { 9,  9,  8,  8,  7,  7,  7,  7,  7,  7,  7,  7,  7,  6,  6,  5,  4,  4,  3,
      3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1
    },
    { 10, 10, 9,  9,  8,  8,  8,  8,  8,  8,  8,  8,  8,  7,  7,  6,  5,  5,  4,
      4,  4,  4,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1
    },
    { 11, 11, 10, 10, 9,  9,  9,  9,  9,  9,  8,  8,  8,  7,  7,  6,  6,  5,  5,
      5,  5,  5,  4,  4,  4,  4,  3,  3,  2,  2,  2,  2,  2,  2,  1,  1,  1
    },
    { 12, 11, 11, 10, 10, 10, 9,  9,  9,  9,  9,  9,  9,  8,  8,  7,  6,  6,  5,
      5,  5,  5,  4,  4,  4,  4,  3,  3,  2,  2,  2,  2,  2,  2,  1,  1,  1
    },
    { 12, 12, 11, 11, 10, 10, 10, 10, 10, 10,  9,  9,  9,  8,  8,  7,  7,  6,  6,
      6,  5,  5,  4,  4,  4,  4,  3,  3,  2,   2,  2,  2,  2,  2,  2,  2,  1
    },
    { 12, 12, 12, 11, 11, 11, 10, 10, 10, 10, 9,  9,  9,  9,  8,  8,  8,  7,  7,
      7,  6,  6,  5,  5,  5,  5,  4,  4,  3,  3,  3,  3,  2,  2,  2,  2,  1
    },
    { 12, 12, 12, 12, 11, 11, 11, 11, 11, 10, 10, 9,  9,  9,  8,  8,  8,  7,  7,
      7,  6,  6,  5,  5,  5,  5,  4,  4,  3,  3,  3,  3,  2,  2,  2,  2,  1
    },
    { 13, 13, 13, 13, 12, 12, 11, 11, 11, 11, 10, 10, 10, 10, 9,  9,  8,  8,  8,
      8,  7,  7,  6,  6,  6,  6,  5,  5,  4,  4,  4,  4,  3,  3,  2,  2,  2
    },
    { 15, 15, 14, 14, 13, 13, 13, 13, 12, 12, 11, 11, 11, 11, 10, 10, 10, 9,  9,
      9,  8,  8,  8,  8,  7,  7,  6,  6,  6,  6,  5,  5,  5,  4,  4,  4,  4
    }
};

hi_u8 g_range_min_qp_10bpc_444_or_rgb[NUM_15][NUM_49] = {
    { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
      0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
    },
    { 4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  3,  3,  2,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,
      1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
    },
    { 7,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,
      2,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
    },
    { 7,  7,  6,  6,  5,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,
      3,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
    },
    { 9,  8,  8,  7,  7,  7,  7,  7,  7,  7,  7,  7,  6,  6,  5,  5,  5,  5,  4,  4,  4,  4,  3,  3,  3,
      3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0
    },
    { 9,  8,  8,  8,  7,  7,  7,  7,  7,  7,  7,  7,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  4,  4,  4,
      4,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  0,  0,  0,  0,  0,  0
    },
    { 9,  9,  8,  8,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  6,  6,  6,  5,  5,  5,  5,  5,  4,  4,
      4,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  1,  1,  1,  1,  0,  0,  0,  0,  0
    },
    { 9,  9,  8,  8,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  6,  6,  6,  6,  6,  6,  5,  5,  5,
      5,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  1,  1,  1,  0,  0,  0,  0
    },
    { 9,  9,  8,  8,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  6,  6,  6,  6,  6,  5,  5,  5,
      5,  5,  5,  5,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  2,  2,  2,  1,  1,  1,  1,  0,  0
    },
    { 10, 9,  9,  8,  8,  8,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  6,  6,  6,  6,  6,  6,  6,
      6,  6,  6,  5,  5,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  1,  1,  1,  1,  0
    },
    { 10, 10, 9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  8,  8,  8,  8,  7,  7,  7,  7,  7,  6,  6,  6,
      6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  3,  3,  3,  2,  2,  2,  1,  1,  1,  1
    },
    { 10, 10, 10, 9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  8,  8,  8,  8,  8,  7,  7,  7,
      7,  7,  7,  6,  6,  6,  6,  5,  5,  5,  5,  4,  4,  4,  4,  3,  3,  3,  3,  2,  2,  1,  1,  1
    },
    { 10, 10, 10, 10, 9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  8,  8,  8,  8,  8,
      8,  7,  7,  6,  6,  6,  6,  5,  5,  5,  5,  4,  4,  4,  4,  3,  3,  3,  3,  2,  2,  2,  2,  1
    },
    { 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 10, 10, 9,  9,  9,
      9,  8,  8,  7,  7,  7,  7,  6,  6,  5,  5,  5,  5,  4,  4,  3,  3,  3,  3,  2,  2,  2,  2,  1
    },
    { 18, 18, 17, 17, 16, 16, 16, 16, 15, 15, 14, 14, 14, 14, 13, 13, 13, 12, 12, 12, 11, 11, 11, 11, 10,
      10,  9,  9,  9,  9,  9,  8,  8,  7,  7,  7,  7,  7,  6,  6,  5,  5,  5,  5,  4,  4,  3,  3,  3
    }
};

hi_u8 g_range_max_qp_10bpc_444_or_rgb[NUM_15][NUM_49] = {
    { 8,  8,  8,  8,  8,  8,  7,  7,  7,  6,  5,  5,  4,  4,  3,  3,  3,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  1,  1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 10, 10, 9,  9,  8,  8,  8,  8,  8,  8,  7,  7,  6,  6,  6,  5,  5,  4,  4,  4,  4,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 12, 11, 11, 10, 9,  9,  9,  9,  9,  9,  9,  9,  8,  8,  8,  7,  6,  6,  5,  5,  5,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  3, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 12, 12, 11, 11, 10, 10, 10, 10, 10, 10, 10, 10, 9,  9,  9,  8,  7,  7,  6,  6,  6,  5,  5,  5,  5,  5,  4,  4,  3,  3,  3,  3, 3, 3, 3, 3, 2, 2, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0 },
    { 13, 12, 12, 11, 11, 11, 11, 11, 11, 11, 11, 11, 10, 10, 9,  8,  8,  7,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  4,  4,  4,  3, 3, 3, 3, 3, 2, 2, 2, 2, 1, 1, 1, 1, 0, 0, 0, 0, 0 },
    { 13, 12, 12, 12, 11, 11, 11, 11, 11, 11, 11, 11, 10, 10, 10, 9,  8,  8,  7,  7,  7,  7,  6,  6,  6,  6,  5,  5,  5,  5,  4,  3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 1, 1, 1, 1, 0, 0 },
    { 13, 13, 12, 12, 11, 11, 11, 11, 11, 11, 11, 11, 11, 10, 10, 9,  8,  8,  7,  7,  7,  7,  7,  6,  6,  6,  5,  5,  5,  5,  4,  4, 4, 4, 4, 4, 4, 3, 3, 3, 2, 2, 2, 2, 1, 1, 1, 1, 1 },
    { 14, 14, 13, 13, 12, 12, 12, 12, 12, 12, 12, 12, 12, 11, 11, 10, 9,  9,  8,  8,  8,  8,  7,  7,  7,  7,  6,  6,  6,  5,  5,  5, 4, 4, 4, 4, 4, 4, 3, 3, 3, 3, 2, 2, 2, 1, 1, 1, 1 },
    { 15, 15, 14, 14, 13, 13, 13, 13, 13, 13, 12, 12, 12, 11, 11, 10, 10, 9,  9,  9,  9,  9,  8,  8,  8,  8,  7,  7,  6,  5,  5,  5, 5, 5, 4, 4, 4, 4, 4, 4, 3, 3, 3, 2, 2, 2, 2, 1, 1 },
    { 16, 15, 15, 14, 14, 14, 13, 13, 13, 13, 13, 13, 13, 12, 12, 11, 10, 10, 9,  9,  9,  9,  8,  8,  8,  8,  7,  7,  6,  6,  5,  5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 2, 2, 2, 2, 1 },
    { 16, 16, 15, 15, 14, 14, 14, 14, 14, 14, 13, 13, 13, 12, 12, 11, 11, 10, 10, 10, 9,  9,  8,  8,  8,  8,  7,  7,  6,  6,  6,  6, 6, 6, 6, 6, 5, 5, 5, 4, 4, 4, 3, 3, 3, 2, 2, 2, 2 },
    { 16, 16, 16, 15, 15, 15, 14, 14, 14, 14, 13, 13, 13, 13, 12, 12, 12, 11, 11, 11, 10, 10, 9,  9,  9,  9,  8,  8,  7,  7,  7,  7, 6, 6, 6, 6, 5, 5, 5, 5, 4, 4, 4, 4, 3, 3, 2, 2, 2 },
    { 16, 16, 16, 16, 15, 15, 15, 15, 15, 14, 14, 13, 13, 13, 12, 12, 12, 11, 11, 11, 10, 10, 9,  9,  9,  9,  8,  8,  7,  7,  7,  7, 6, 6, 6, 6, 5, 5, 5, 5, 4, 4, 4, 4, 3, 3, 3, 3, 2 },
    { 17, 17, 17, 17, 16, 16, 15, 15, 15, 15, 14, 14, 14, 14, 13, 13, 12, 12, 12, 12, 11, 11, 10, 10, 10, 10, 9,  9,  8,  8,  8,  8, 7, 7, 6, 6, 6, 6, 5, 5, 4, 4, 4, 4, 3, 3, 3, 3, 2 },
    { 19, 19, 18, 18, 17, 17, 17, 17, 16, 16, 15, 15, 15, 15, 14, 14, 14, 13, 13, 13, 12, 12, 12, 12, 11, 11, 10, 10, 10, 10, 10, 9, 9, 8, 8, 8, 8, 8, 7, 7, 6, 6, 6, 6, 5, 5, 4, 4, 4 }
};

hi_u8 g_range_min_qp_12bpc_444_or_rgb[NUM_15][NUM_61] = {
    { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  4,  3,  3,  2,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 11, 10, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8,  7,  7,  7,  6,  5,  5,  4,  4,  4,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  1,  1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 11, 11, 10, 10, 9,  9,  9,  9,  9,  9,  9,  9,  8,  8,  8,  7,  6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  4,  4,  3,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 13, 12, 12, 11, 11, 11, 11, 11, 11, 11, 11, 11, 10, 10, 9,  9,  9,  8,  7,  7,  7,  7,  5,  5,  5,  5,  5,  5,  4,  4,  4,  3,  3,  3,  3,  3,  3,  3,  3,  3,  2, 2, 2, 2, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 13, 12, 12, 12, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 10, 9,  9,  8,  8,  8,  8,  6,  6,  6,  6,  5,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  4,  4,  3, 3, 3, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 13, 13, 12, 12, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 10, 9,  9,  9,  9,  9,  9,  9,  8,  8,  8,  7,  7,  7,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  4,  4, 4, 4, 4, 3, 3, 3, 2, 2, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0 },
    { 13, 13, 12, 12, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 10, 10, 10, 10, 10, 10, 9,  9,  9,  9,  8,  8,  8,  7,  7,  7,  6,  6,  6,  6,  6,  6,  5,  5,  5, 5, 4, 4, 4, 3, 3, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 0, 0, 0, 0 },
    { 13, 13, 12, 12, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 10, 10, 10, 10, 9,  9,  8,  7,  7,  7,  7,  7,  6,  6,  6,  6,  6,  6,  5, 5, 5, 4, 4, 4, 4, 3, 3, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0 },
    { 14, 13, 13, 12, 12, 12, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 10, 10, 10, 10, 9,  9,  8,  8,  8,  8,  8,  8,  7,  7,  7,  7,  7,  6,  6, 5, 5, 5, 4, 4, 4, 4, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 1, 1, 0 },
    { 14, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 12, 12, 12, 12, 12, 11, 11, 11, 11, 11, 11, 10, 10, 9,  9,  9,  9,  9,  9,  9,  9,  8,  8,  8,  7,  7, 7, 6, 6, 6, 5, 5, 5, 5, 4, 4, 3, 3, 3, 2, 2, 2, 2, 1, 1, 1 },
    { 14, 14, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 12, 12, 11, 11, 11, 11, 11, 11, 10, 10, 10, 10, 9,  9,  9,  9,  8,  8,  8,  8,  7, 7, 7, 7, 6, 6, 5, 5, 5, 4, 4, 4, 3, 3, 3, 3, 2, 2, 1, 1, 1 },
    { 14, 14, 14, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 12, 12, 12, 12, 12, 12, 11, 11, 10, 10, 10, 10, 9,  9,  9,  9,  8,  8,  8,  8,  7, 7, 7, 7, 6, 6, 6, 6, 5, 4, 4, 4, 3, 3, 3, 3, 2, 2, 1, 1, 1 },
    { 17, 17, 17, 17, 16, 16, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 14, 14, 13, 13, 13, 13, 12, 12, 11, 11, 11, 11, 10, 10, 9,  9,  9,  9,  8,  8,  7, 7, 7, 7, 7, 6, 6, 6, 5, 5, 5, 5, 4, 4, 3, 3, 3, 3, 2, 2, 1 },
    { 22, 22, 21, 21, 20, 20, 20, 20, 19, 19, 18, 18, 18, 18, 17, 17, 17, 16, 16, 16, 15, 15, 15, 15, 14, 14, 13, 13, 13, 13, 13, 12, 12, 11, 11, 11, 11, 11, 10, 10, 9, 9, 9, 9, 9, 8, 8, 7, 7, 7, 7, 7, 6, 6, 5, 5, 5, 5, 4, 4, 3 }
};

hi_u8 g_range_max_qp_12bpc_444_or_rgb[NUM_15][NUM_61] = {
    { 12, 12, 12, 12, 12, 12, 11, 11, 11, 10, 9,  9,  6,  6,  5,  5,  5,  4,  4,  4,  4,  4,  4,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 14, 14, 13, 13, 12, 12, 12, 12, 12, 12, 11, 11, 9,  9,  9,  8,  8,  7,  7,  7,  7,  5,  5,  5,  5,  5,  4,  4,  4,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 16, 15, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 12, 12, 12, 11, 10, 10, 9,  9,  9,  7,  7,  7,  7,  7,  6,  6,  5,  5,  5,  5,  4,  4,  4,  3,  3,  3,  3,  3,  3,  2,  2,  2,  1,  1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 16, 16, 15, 15, 14, 14, 14, 14, 14, 14, 14, 14, 13, 13, 13, 12, 11, 11, 10, 10, 10, 8,  8,  8,  8,  8,  7,  7,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4,  3,  3,  3,  3,  3,  2,  2,  2, 2, 2, 2, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 17, 16, 16, 15, 15, 15, 15, 15, 15, 15, 15, 15, 14, 14, 13, 12, 12, 11, 10, 10, 10, 10, 8,  8,  8,  8,  8,  8,  7,  7,  7,  6,  6,  5,  5,  5,  4,  4,  4,  4,  3,  3,  3,  3,  2,  2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0 },
    { 17, 16, 16, 16, 15, 15, 15, 15, 15, 15, 15, 15, 14, 14, 14, 13, 12, 12, 11, 11, 11, 11, 9,  9,  9,  9,  8,  8,  8,  8,  7,  6,  6,  6,  6,  6,  5,  5,  5,  5,  4,  4,  4,  3,  3,  3, 3, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 0 },
    { 17, 17, 16, 16, 15, 15, 15, 15, 15, 15, 15, 15, 15, 14, 14, 13, 12, 12, 11, 11, 11, 11, 11, 10, 10, 10, 9,  9,  9,  8,  7,  7,  7,  7,  7,  7,  7,  6,  6,  6,  5,  5,  5,  5,  4,  4, 4, 3, 3, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 0 },
    { 18, 18, 17, 17, 16, 16, 16, 16, 16, 16, 16, 16, 16, 15, 15, 14, 13, 13, 12, 12, 12, 12, 11, 11, 11, 11, 10, 10, 10, 8,  8,  8,  7,  7,  7,  7,  7,  7,  6,  6,  6,  6,  5,  5,  5,  4, 4, 3, 3, 3, 3, 3, 3, 2, 2, 2, 2, 1, 1, 1, 1 },
    { 19, 19, 18, 18, 17, 17, 17, 17, 17, 17, 16, 16, 16, 15, 15, 14, 14, 13, 13, 13, 13, 13, 12, 12, 12, 12, 11, 11, 10, 9,  8,  8,  8,  8,  7,  7,  7,  7,  7,  7,  6,  6,  6,  5,  5,  5, 5, 4, 4, 3, 3, 3, 3, 2, 2, 2, 2, 2, 2, 1, 1 },
    { 20, 19, 19, 18, 18, 18, 17, 17, 17, 17, 17, 17, 17, 16, 16, 15, 14, 14, 13, 13, 13, 13, 12, 12, 12, 12, 11, 11, 10, 10, 9,  9,  9,  9,  8,  8,  8,  8,  8,  7,  7,  6,  6,  6,  5,  5, 5, 5, 4, 4, 4, 4, 4, 3, 3, 3, 3, 3, 2, 2, 1 },
    { 20, 20, 19, 19, 18, 18, 18, 18, 18, 18, 17, 17, 17, 16, 16, 15, 15, 14, 14, 14, 13, 13, 12, 12, 12, 12, 11, 11, 10, 10, 10, 10, 10, 10, 10, 10, 9,  9,  9,  8,  8,  8,  7,  7,  7,  6, 6, 6, 6, 5, 5, 4, 4, 4, 3, 3, 3, 3, 2, 2, 2 },
    { 20, 20, 20, 19, 19, 19, 18, 18, 18, 18, 17, 17, 17, 17, 16, 16, 16, 15, 15, 15, 14, 14, 13, 13, 13, 13, 12, 12, 11, 11, 11, 11, 10, 10, 10, 10, 9,  9,  9,  9,  8,  8,  8,  8,  7,  7, 6, 6, 6, 5, 5, 5, 4, 4, 4, 4, 3, 3, 2, 2, 2 },
    { 20, 20, 20, 20, 19, 19, 19, 19, 19, 18, 18, 17, 17, 17, 16, 16, 16, 15, 15, 15, 14, 14, 13, 13, 13, 13, 12, 12, 11, 11, 11, 11, 10, 10, 10, 10, 9,  9,  9,  9,  8,  8,  8,  8,  7,  7, 7, 7, 6, 5, 5, 5, 4, 4, 4, 4, 3, 3, 2, 2, 2 },
    { 21, 21, 21, 21, 20, 20, 19, 19, 19, 19, 18, 18, 18, 18, 17, 17, 16, 16, 16, 16, 15, 15, 14, 14, 14, 14, 13, 13, 12, 12, 12, 12, 11, 11, 10, 10, 10, 10, 9,  9,  8,  8,  8,  8,  8,  7, 7, 7, 6, 6, 6, 6, 5, 5, 4, 4, 4, 4, 3, 3, 2 },
    { 23, 23, 22, 22, 21, 21, 21, 21, 20, 20, 19, 19, 19, 19, 18, 18, 18, 17, 17, 17, 16, 16, 16, 16, 15, 15, 14, 14, 14, 14, 14, 13, 13, 12, 12, 12, 12, 12, 11, 11, 10, 10, 10, 10, 10, 9, 9, 8, 8, 8, 8, 8, 7, 7, 6, 6, 6, 6, 5, 5, 4 }
};

hi_u8 g_range_min_qp_8bpc_422[NUM_15][NUM_21] = {
    { 0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 1,  1,  1,  1,  1,  1,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 2,  2,  2,  2,  2,  2,  1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 3,  3,  3,  3,  3,  2,  2, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0 },
    { 3,  3,  3,  3,  3,  2,  2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0 },
    { 3,  3,  3,  3,  3,  2,  2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0 },
    { 3,  3,  3,  3,  3,  3,  2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 0, 0 },
    { 3,  3,  3,  3,  3,  3,  2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1 },
    { 3,  3,  3,  3,  3,  3,  3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 1, 1, 1 },
    { 5,  5,  5,  5,  5,  4,  4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 2, 2, 1, 1, 1 },
    { 5,  5,  5,  5,  5,  5,  5, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 2, 2, 1, 1 },
    { 5,  5,  5,  5,  5,  5,  5, 5, 5, 5, 5, 5, 5, 4, 4, 3, 3, 2, 2, 1, 1 },
    { 8,  8,  7,  7,  7,  7,  7, 7, 7, 7, 6, 6, 5, 5, 4, 4, 3, 3, 2, 2, 2 },
    { 12, 12, 11, 11, 10, 10, 9, 9, 8, 8, 7, 7, 6, 6, 5, 5, 4, 4, 4, 3, 3 }
};

hi_u8 g_range_max_qp_8bpc_422[NUM_15][NUM_21] = {
    { 4,  4,  3,  3,  2,  2,  1,  1,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 4,  4,  4,  4,  4,  3,  2,  2,  1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 5,  5,  5,  5,  5,  4,  3,  2,  1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0 },
    { 6,  6,  6,  6,  6,  5,  4,  3,  2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0 },
    { 7,  7,  7,  7,  7,  6,  5,  3,  2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1 },
    { 7,  7,  7,  7,  7,  6,  5,  4,  3, 3, 3, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1 },
    { 7,  7,  7,  7,  7,  6,  5,  4,  3, 3, 3, 3, 3, 2, 2, 2, 2, 2, 1, 1, 1 },
    { 8,  8,  8,  8,  8,  7,  6,  5,  4, 4, 4, 3, 3, 3, 3, 2, 2, 2, 2, 1, 1 },
    { 9,  9,  9,  8,  8,  7,  6,  6,  5, 5, 5, 4, 4, 3, 3, 3, 3, 2, 2, 2, 2 },
    { 10, 10, 9,  9,  9,  8,  7,  6,  5, 5, 5, 5, 4, 4, 4, 3, 3, 3, 2, 2, 2 },
    { 10, 10, 10, 9,  9,  8,  7,  7,  6, 6, 6, 5, 5, 4, 4, 4, 3, 3, 2, 2, 2 },
    { 11, 11, 10, 10, 9,  9,  8,  7,  7, 7, 6, 6, 5, 5, 4, 4, 4, 3, 3, 2, 2 },
    { 11, 11, 11, 10, 9,  9,  8,  8,  7, 7, 7, 6, 6, 5, 5, 4, 4, 3, 3, 2, 2 },
    { 12, 12, 11, 11, 10, 10, 9,  9,  8, 8, 7, 7, 6, 6, 5, 5, 4, 4, 3, 3, 3 },
    { 13, 13, 12, 12, 11, 11, 10, 10, 9, 9, 8, 8, 7, 7, 6, 6, 5, 5, 5, 4, 4 }
};

hi_u8 g_range_min_qp_10bpc_422[NUM_15][NUM_29] = {
    { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 4,  4,  4,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 5,  5,  5,  4,  3,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2, 2, 2, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 6,  6,  6,  6,  5,  4,  4,  4,  3,  3,  3,  3,  3,  2,  2, 2, 2, 2, 2, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0 },
    { 6,  6,  6,  6,  5,  5,  5,  4,  4,  4,  4,  4,  4,  4,  4, 3, 3, 3, 2, 2, 2, 1, 1, 1, 0, 0, 0, 0, 0 },
    { 6,  6,  6,  6,  6,  5,  5,  5,  5,  4,  4,  4,  4,  4,  4, 4, 4, 3, 3, 3, 3, 2, 1, 1, 0, 0, 0, 0, 0 },
    { 6,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  5,  4,  4, 4, 4, 4, 3, 3, 3, 2, 2, 1, 1, 1, 0, 0, 0 },
    { 7,  7,  7,  7,  7,  6,  6,  6,  6,  6,  6,  5,  5,  5,  5, 4, 4, 4, 4, 3, 3, 3, 2, 2, 1, 1, 1, 1, 1 },
    { 7,  7,  7,  7,  7,  6,  6,  6,  6,  6,  6,  6,  6,  5,  5, 5, 4, 4, 4, 4, 4, 3, 2, 2, 1, 1, 1, 1, 1 },
    { 8,  8,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  6,  6,  6, 6, 5, 5, 4, 4, 4, 3, 3, 2, 2, 1, 1, 1, 1 },
    { 9,  9,  9,  8,  8,  8,  8,  8,  8,  8,  8,  7,  7,  6,  6, 6, 5, 5, 5, 5, 5, 3, 3, 2, 2, 2, 1, 1, 1 },
    { 9,  9,  9,  9,  8,  8,  8,  8,  8,  8,  8,  8,  7,  7,  6, 6, 6, 6, 6, 5, 5, 4, 3, 3, 2, 2, 1, 1, 1 },
    { 9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  8,  8,  8,  8, 7, 7, 6, 6, 5, 5, 4, 3, 3, 3, 2, 2, 1, 1 },
    { 12, 12, 11, 11, 11, 11, 11, 11, 11, 11, 10, 10, 9,  9,  8, 8, 7, 7, 6, 6, 5, 5, 4, 4, 3, 3, 2, 2, 1 },
    { 16, 16, 15, 15, 14, 14, 13, 13, 12, 12, 11, 11, 10, 10, 9, 9, 8, 8, 8, 7, 7, 6, 6, 5, 5, 5, 4, 4, 3 }
};

hi_u8 g_range_max_qp_10bpc_422[NUM_15][NUM_29] = {
    { 8,  8,  7,  5,  4,  4,  3,  3,  2,  2,  2,  2,  2,  2,  1,  1,  1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 8,  8,  8,  6,  6,  5,  4,  4,  3,  3,  3,  3,  3,  2,  2,  2,  2, 2, 2, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0 },
    { 9,  9,  9,  8,  7,  6,  5,  4,  3,  3,  3,  3,  3,  3,  3,  3,  3, 2, 2, 2, 2, 1, 1, 1, 0, 0, 0, 0, 0 },
    { 10, 10, 10, 10, 9,  8,  7,  6,  5,  5,  5,  5,  5,  4,  4,  3,  3, 3, 3, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1 },
    { 11, 11, 11, 11, 10, 9,  8,  6,  5,  5,  5,  5,  5,  5,  5,  4,  4, 4, 3, 3, 3, 2, 2, 2, 1, 1, 1, 1, 1 },
    { 11, 11, 11, 11, 11, 10, 9,  8,  7,  6,  6,  5,  5,  5,  5,  5,  5, 4, 4, 4, 4, 3, 2, 2, 1, 1, 1, 1, 1 },
    { 11, 11, 11, 11, 11, 10, 9,  8,  7,  7,  7,  7,  7,  6,  6,  6,  5, 5, 4, 4, 4, 3, 3, 2, 2, 2, 1, 1, 1 },
    { 12, 12, 12, 12, 12, 11, 10, 9,  8,  8,  8,  7,  7,  7,  7,  6,  5, 5, 5, 4, 4, 4, 3, 3, 2, 2, 2, 2, 2 },
    { 13, 13, 13, 12, 12, 11, 10, 10, 9,  9,  9,  8,  8,  7,  7,  7,  6, 5, 5, 5, 5, 4, 3, 3, 2, 2, 2, 2, 2 },
    { 14, 14, 13, 13, 13, 12, 11, 10, 9,  9,  9,  9,  8,  8,  8,  7,  6, 6, 5, 5, 5, 4, 4, 3, 3, 2, 2, 2, 2 },
    { 14, 14, 14, 13, 13, 12, 11, 11, 10, 10, 10, 9,  9,  8,  8,  8,  7, 7, 6, 6, 6, 4, 4, 3, 3, 3, 2, 2, 2 },
    { 15, 15, 14, 14, 13, 13, 12, 11, 11, 11, 10, 10, 9,  9,  8,  8,  8, 7, 7, 6, 6, 5, 4, 4, 3, 3, 2, 2, 2 },
    { 15, 15, 15, 14, 13, 13, 12, 12, 11, 11, 11, 10, 10, 9,  9,  8,  8, 7, 7, 6, 6, 5, 4, 4, 4, 3, 3, 2, 2 },
    { 16, 16, 15, 15, 14, 14, 13, 13, 12, 12, 11, 11, 10, 10, 9,  9,  8, 8, 7, 7, 6, 6, 5, 5, 4, 4, 3, 3, 2 },
    { 17, 17, 16, 16, 15, 15, 14, 14, 13, 13, 12, 12, 11, 11, 10, 10, 9, 9, 9, 8, 8, 7, 7, 6, 6, 6, 5, 5, 4 }
};

hi_u8 g_range_min_qp_12bpc_422[NUM_15][NUM_37] = {
    { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 4,  4,  4,  4,  4,  3,  3,  3,  2,  2,  2,  2,  2,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 9,  9,  9,  8,  7,  6,  5,  5,  4,  4,  4,  4,  4,  4,  3,  3,  2,  1,  1,  1,  1,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 10, 10, 10, 10, 8,  8,  8,  7,  6,  6,  6,  6,  6,  5,  4,  3,  3,  3,  3,  2,  2,  2,  1,  1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 11, 11, 11, 11, 10, 9,  9,  8,  7,  7,  7,  7,  6,  6,  5,  4,  4,  4,  3,  3,  3,  2,  2,  2, 2, 2, 2, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0 },
    { 11, 11, 11, 11, 11, 10, 10, 9,  9,  8,  8,  7,  6,  6,  5,  5,  5,  4,  4,  4,  4,  3,  2,  2, 2, 2, 2, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0 },
    { 11, 11, 11, 11, 11, 10, 10, 10, 9,  9,  9,  9,  8,  7,  7,  7,  6,  6,  5,  5,  5,  4,  4,  3, 3, 3, 2, 2, 2, 2, 2, 1, 1, 0, 0, 0, 0 },
    { 11, 11, 11, 11, 11, 11, 10, 10, 10, 10, 10, 9,  8,  8,  8,  7,  6,  6,  6,  5,  5,  5,  4,  4, 3, 3, 3, 3, 3, 2, 2, 2, 1, 1, 0, 0, 0 },
    { 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 10, 9,  8,  8,  8,  7,  6,  6,  6,  6,  5,  4,  4, 3, 3, 3, 3, 3, 3, 3, 2, 2, 1, 0, 0, 0 },
    { 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 9,  9,  9,  8,  7,  7,  6,  6,  6,  5,  5,  4, 4, 3, 3, 3, 3, 3, 3, 2, 2, 1, 1, 0, 0 },
    { 13, 13, 13, 13, 13, 12, 12, 12, 12, 12, 12, 11, 11, 10, 10, 10, 9,  9,  8,  8,  8,  6,  6,  5, 5, 5, 4, 4, 4, 4, 3, 3, 2, 2, 1, 1, 1 },
    { 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 12, 12, 11, 11, 10, 10, 10, 9,  9,  8,  8,  7,  6,  6, 5, 5, 4, 4, 4, 4, 4, 3, 3, 2, 2, 1, 1 },
    { 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 12, 12, 11, 11, 10, 10, 9,  9,  8,  8,  7,  6,  6, 6, 5, 5, 4, 4, 4, 4, 3, 3, 2, 2, 1, 1 },
    { 16, 16, 15, 15, 15, 15, 15, 15, 15, 15, 14, 14, 13, 13, 12, 12, 11, 11, 10, 10, 9,  9,  8,  8, 7, 7, 6, 6, 5, 5, 4, 4, 4, 3, 3, 2, 2 },
    { 20, 20, 19, 19, 18, 18, 17, 17, 16, 16, 15, 15, 14, 14, 13, 13, 12, 12, 12, 11, 11, 10, 10, 9, 9, 9, 8, 8, 7, 7, 6, 6, 6, 5, 5, 4, 4 }
};

hi_u8 g_range_max_qp_12bpc_422[NUM_15][NUM_37] = {
    { 12, 12, 11, 9,  6,  6,  5,  5,  4,  4,  4,  3,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  1,  1,  1,  1,  1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 12, 12, 12, 10, 9,  8,  7,  7,  6,  6,  5,  5,  5,  4,  4,  4,  3,  3,  3,  2,  2,  2,  1,  1,  1,  1,  1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 13, 13, 13, 12, 10, 9,  8,  7,  6,  6,  6,  6,  6,  6,  5,  5,  4,  3,  3,  3,  3,  2,  2,  2,  1,  1,  1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 14, 14, 14, 14, 12, 11, 10, 9,  8,  8,  8,  8,  8,  7,  6,  5,  5,  5,  5,  4,  4,  4,  3,  3,  2,  2,  2, 2, 2, 1, 1, 0, 0, 0, 0, 0, 0 },
    { 15, 15, 15, 15, 14, 13, 12, 10, 9,  9,  9,  9,  8,  8,  7,  6,  6,  6,  5,  5,  5,  4,  4,  4,  3,  3,  3, 2, 2, 2, 1, 1, 1, 1, 0, 0, 0 },
    { 15, 15, 15, 15, 15, 14, 13, 12, 11, 10, 10, 9,  8,  8,  7,  7,  7,  6,  6,  6,  6,  5,  4,  4,  3,  3,  3, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1 },
    { 15, 15, 15, 15, 15, 14, 13, 12, 11, 11, 11, 11, 10, 9,  9,  9,  8,  8,  7,  7,  7,  6,  6,  5,  5,  5,  4, 4, 4, 3, 3, 2, 2, 1, 1, 1, 1 },
    { 16, 16, 16, 16, 16, 15, 14, 13, 12, 12, 12, 11, 10, 10, 10, 9,  8,  8,  8,  7,  7,  7,  6,  6,  5,  5,  5, 5, 5, 3, 3, 3, 2, 2, 1, 1, 1 },
    { 17, 17, 17, 16, 16, 15, 14, 14, 13, 13, 13, 12, 11, 10, 10, 10, 9,  8,  8,  8,  8,  7,  6,  6,  5,  5,  5, 5, 5, 4, 4, 3, 3, 2, 1, 1, 1 },
    { 18, 18, 17, 17, 17, 16, 15, 14, 13, 13, 13, 13, 11, 11, 11, 10, 9,  9,  8,  8,  8,  7,  7,  6,  6,  5,  5, 5, 5, 4, 4, 3, 3, 2, 2, 1, 1 },
    { 18, 18, 18, 17, 17, 16, 15, 15, 14, 14, 14, 13, 13, 12, 12, 12, 11, 11, 10, 10, 10, 8,  8,  7,  7,  7,  6, 6, 6, 5, 4, 4, 3, 3, 2, 2, 2 },
    { 19, 19, 18, 18, 17, 17, 16, 15, 15, 15, 14, 14, 13, 13, 12, 12, 12, 11, 11, 10, 10, 9,  8,  8,  7,  7,  6, 6, 6, 5, 5, 4, 4, 3, 3, 2, 2 },
    { 19, 19, 19, 18, 17, 17, 16, 16, 15, 15, 15, 14, 14, 13, 13, 12, 12, 11, 11, 10, 10, 9,  8,  8,  8,  7,  7, 6, 6, 5, 5, 4, 4, 3, 3, 2, 2 },
    { 20, 20, 19, 19, 18, 18, 17, 17, 16, 16, 15, 15, 14, 14, 13, 13, 12, 12, 11, 11, 10, 10, 9,  9,  8,  8,  7, 7, 6, 6, 5, 5, 5, 4, 4, 3, 3 },
    { 21, 21, 20, 20, 19, 19, 18, 18, 17, 17, 16, 16, 15, 15, 14, 14, 13, 13, 13, 12, 12, 11, 11, 10, 10, 10, 9, 9, 8, 8, 7, 7, 7, 6, 6, 5, 5 }
};

hi_u8 g_range_min_qp_8bpc_420[NUM_15][NUM_17] = {
    { 0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 1,  1,  1,  1,  1,  1,  1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 1,  1,  1,  1,  1,  1,  1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 3,  3,  3,  3,  3,  2,  1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0 },
    { 3,  3,  3,  3,  3,  2,  2, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0 },
    { 3,  3,  3,  3,  3,  3,  2, 2, 1, 1, 1, 1, 1, 1, 1, 0, 0 },
    { 3,  3,  3,  3,  3,  3,  2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 0 },
    { 3,  3,  3,  3,  3,  3,  2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 0 },
    { 3,  3,  3,  3,  3,  3,  3, 3, 3, 3, 3, 3, 3, 2, 2, 1, 1 },
    { 5,  5,  5,  5,  5,  4,  4, 4, 4, 4, 3, 3, 3, 3, 2, 1, 1 },
    { 5,  5,  5,  5,  5,  5,  5, 4, 4, 4, 4, 4, 4, 3, 2, 2, 1 },
    { 5,  5,  5,  5,  5,  5,  5, 5, 5, 5, 5, 4, 4, 3, 3, 2, 1 },
    { 9,  8,  8,  7,  7,  7,  7, 7, 7, 6, 5, 5, 4, 3, 3, 3, 2 },
    { 13, 12, 12, 11, 10, 10, 9, 8, 8, 7, 6, 6, 5, 5, 4, 4, 3 }
};

hi_u8 g_range_max_qp_8bpc_420[NUM_15][NUM_17] = {
    { 4,  4,  3,  3,  2,  2,  1,  1, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 4,  4,  4,  4,  4,  3,  2,  2, 1, 1, 1, 1, 0, 0, 0, 0, 0 },
    { 5,  5,  5,  5,  5,  4,  3,  2, 1, 1, 1, 1, 1, 1, 0, 0, 0 },
    { 6,  6,  6,  6,  6,  5,  4,  3, 2, 2, 2, 1, 1, 1, 1, 0, 0 },
    { 7,  7,  7,  7,  7,  5,  4,  3, 2, 2, 2, 2, 2, 1, 1, 1, 0 },
    { 7,  7,  7,  7,  7,  6,  5,  4, 3, 3, 3, 2, 2, 2, 1, 1, 0 },
    { 7,  7,  7,  7,  7,  6,  5,  4, 3, 3, 3, 3, 2, 2, 2, 1, 1 },
    { 8,  8,  8,  8,  8,  7,  6,  5, 4, 4, 4, 3, 3, 2, 2, 2, 1 },
    { 9,  9,  9,  8,  8,  7,  6,  6, 5, 5, 4, 4, 3, 3, 2, 2, 1 },
    { 10, 10, 9,  9,  9,  8,  7,  6, 5, 5, 5, 4, 4, 3, 3, 2, 2 },
    { 10, 10, 10, 9,  9,  8,  8,  7, 6, 6, 5, 5, 4, 4, 3, 2, 2 },
    { 11, 11, 10, 10, 9,  9,  8,  7, 7, 6, 6, 5, 5, 4, 3, 3, 2 },
    { 11, 11, 11, 10, 9,  9,  9,  8, 7, 7, 6, 5, 5, 4, 4, 3, 2 },
    { 13, 12, 12, 11, 10, 10, 9,  8, 8, 7, 6, 6, 5, 4, 4, 4, 3 },
    { 14, 13, 13, 12, 11, 11, 10, 9, 9, 8, 7, 7, 6, 6, 5, 5, 4 }
};

hi_u8 g_range_min_qp_10bpc_420[NUM_15][NUM_23] = {
    { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 4,  4,  4,  3,  2,  2,  2,  2,  2,  2,  2,  2,  1,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 4,  4,  4,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2, 1, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 5,  5,  5,  4,  4,  4,  4,  4,  4,  3,  3,  2,  2,  2, 2, 1, 0, 0, 0, 0, 0, 0, 0 },
    { 7,  7,  7,  6,  6,  5,  5,  4,  4,  3,  3,  3,  3,  2, 2, 2, 1, 1, 1, 0, 0, 0, 0 },
    { 7,  7,  7,  7,  7,  6,  5,  5,  5,  5,  5,  4,  3,  3, 2, 2, 1, 1, 1, 1, 1, 0, 0 },
    { 7,  7,  7,  7,  7,  6,  6,  5,  5,  5,  5,  4,  4,  4, 3, 2, 2, 2, 2, 1, 1, 1, 0 },
    { 7,  7,  7,  7,  7,  7,  6,  6,  6,  6,  6,  5,  4,  4, 4, 3, 2, 2, 2, 1, 1, 1, 0 },
    { 7,  7,  7,  7,  7,  7,  7,  7,  6,  6,  6,  6,  5,  5, 4, 4, 3, 3, 2, 2, 2, 1, 1 },
    { 7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  7,  6,  6,  5, 5, 4, 4, 3, 3, 2, 2, 1, 1 },
    { 9,  9,  9,  9,  9,  8,  8,  8,  8,  8,  7,  7,  6,  6, 5, 5, 4, 4, 3, 3, 2, 2, 1 },
    { 9,  9,  9,  9,  9,  9,  8,  8,  8,  8,  8,  8,  8,  7, 6, 6, 5, 4, 4, 3, 3, 2, 1 },
    { 9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  8,  8,  7, 7, 6, 5, 4, 4, 3, 3, 2, 1 },
    { 13, 12, 12, 11, 11, 11, 11, 11, 11, 10, 9,  9,  8,  7, 7, 6, 5, 5, 4, 3, 3, 2, 2 },
    { 17, 16, 16, 15, 14, 14, 13, 12, 12, 11, 10, 10, 10, 9, 8, 8, 7, 6, 6, 5, 5, 4, 4 }
};

hi_u8 g_range_max_qp_10bpc_420[NUM_15][NUM_23] = {
    { 8,  8,  7,  6,  4,  4,  3,  3,  2,  1,  1,  1,  1,  1,  0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 8,  8,  8,  7,  6,  5,  4,  4,  3,  3,  3,  3,  2,  1,  1, 1, 0, 0, 0, 0, 0, 0, 0 },
    { 9,  9,  9,  8,  8,  7,  6,  5,  4,  3,  3,  3,  3,  3,  2, 1, 1, 1, 0, 0, 0, 0, 0 },
    { 10, 10, 10, 9,  9,  8,  7,  6,  5,  4,  4,  3,  3,  3,  3, 2, 1, 1, 1, 1, 1, 0, 0 },
    { 11, 11, 11, 10, 10, 8,  7,  6,  5,  4,  4,  4,  4,  3,  3, 3, 2, 2, 2, 1, 1, 1, 0 },
    { 11, 11, 11, 10, 10, 9,  8,  7,  6,  6,  6,  5,  4,  4,  3, 3, 2, 2, 2, 2, 2, 1, 1 },
    { 11, 11, 11, 11, 11, 10, 9,  8,  7,  7,  7,  6,  5,  5,  4, 3, 3, 3, 3, 2, 2, 2, 1 },
    { 12, 12, 12, 12, 12, 11, 10, 9,  8,  8,  8,  7,  6,  5,  5, 4, 3, 3, 3, 2, 2, 2, 1 },
    { 13, 13, 13, 12, 12, 11, 10, 10, 9,  9,  8,  8,  7,  7,  6, 5, 4, 4, 3, 3, 3, 2, 2 },
    { 14, 14, 13, 13, 13, 12, 11, 10, 9,  9,  9,  8,  8,  7,  7, 6, 5, 4, 4, 3, 3, 2, 2 },
    { 14, 14, 14, 13, 13, 12, 12, 11, 10, 10, 9,  9,  8,  8,  7, 6, 5, 5, 4, 4, 3, 3, 2 },
    { 15, 15, 14, 14, 13, 13, 12, 11, 11, 10, 10, 9,  9,  8,  7, 7, 6, 5, 5, 4, 4, 3, 2 },
    { 15, 15, 15, 14, 13, 13, 13, 12, 11, 11, 10, 9,  9,  8,  8, 7, 6, 5, 5, 4, 4, 3, 2 },
    { 17, 16, 16, 15, 14, 14, 13, 12, 12, 11, 10, 10, 9,  8,  8, 7, 6, 6, 5, 4, 4, 3, 3 },
    { 18, 17, 17, 16, 15, 15, 14, 13, 13, 12, 11, 11, 11, 10, 9, 9, 8, 7, 7, 6, 6, 5, 5 }
};

hi_u8 g_range_min_qp_12bpc_420[NUM_15][NUM_29] = {
    { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 4,  4,  4,  4,  4,  4,  3,  3,  2,  2,  2,  2,  2,  2,  2,  1,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 9,  8,  8,  7,  7,  6,  5,  5,  4,  4,  4,  4,  3,  3,  3,  2,  2,  1,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 10, 9,  9,  8,  8,  8,  7,  7,  6,  6,  6,  5,  5,  4,  4,  3,  2,  2,  1,  1,  1, 0, 0, 0, 0, 0, 0, 0, 0 },
    { 11, 10, 10, 10, 10, 9,  9,  8,  7,  6,  6,  6,  6,  5,  5,  4,  3,  3,  3,  2,  2, 1, 0, 0, 0, 0, 0, 0, 0 },
    { 11, 11, 11, 11, 11, 10, 10, 9,  9,  9,  9,  8,  7,  6,  5,  5,  4,  4,  3,  3,  3, 2, 1, 1, 0, 0, 0, 0, 0 },
    { 11, 11, 11, 11, 11, 11, 10, 10, 9,  9,  9,  8,  8,  7,  6,  5,  5,  5,  5,  4,  3, 3, 2, 1, 1, 1, 1, 1, 0 },
    { 11, 11, 11, 11, 11, 11, 11, 10, 10, 10, 10, 9,  8,  8,  8,  7,  6,  6,  5,  4,  4, 3, 2, 2, 1, 1, 1, 1, 1 },
    { 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 10, 10, 9,  9,  8,  8,  7,  7,  6,  5,  5, 4, 4, 2, 2, 1, 1, 1, 1 },
    { 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 10, 10, 9,  9,  8,  8,  7,  7,  6,  5, 4, 4, 3, 2, 2, 1, 1, 1 },
    { 13, 13, 13, 13, 13, 13, 13, 12, 12, 12, 11, 11, 10, 10, 9,  9,  8,  8,  7,  7,  6, 5, 4, 3, 3, 2, 2, 1, 1 },
    { 13, 13, 13, 13, 13, 13, 13, 13, 13, 12, 12, 12, 12, 11, 10, 10, 9,  8,  8,  7,  7, 6, 5, 4, 3, 3, 2, 2, 1 },
    { 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 12, 12, 11, 11, 10, 9,  8,  8,  7,  7, 6, 5, 4, 4, 3, 2, 2, 1 },
    { 15, 15, 15, 15, 15, 15, 15, 15, 15, 14, 13, 13, 12, 11, 11, 10, 9,  9,  8,  8,  7, 6, 6, 5, 4, 4, 3, 3, 2 },
    { 21, 20, 20, 19, 18, 18, 17, 16, 16, 15, 14, 14, 14, 13, 12, 12, 11, 10, 10, 10, 9, 8, 8, 7, 6, 6, 5, 5, 4 }
};

hi_u8 g_range_max_qp_12bpc_420[NUM_15][NUM_29] = {
    { 11, 10, 9,  8,  6,  6,  5,  5,  4,  3,  3,  2,  2,  2,  1,  1,  1,  1,  1,  1,  1,  0, 0, 0, 0, 0, 0, 0, 0 },
    { 12, 11, 11, 10, 9,  8,  7,  7,  6,  6,  5,  5,  4,  3,  3,  2,  1,  1,  1,  1,  1,  1, 1, 0, 0, 0, 0, 0, 0 },
    { 13, 12, 12, 11, 11, 10, 9,  8,  7,  6,  6,  6,  5,  5,  4,  3,  3,  2,  1,  1,  1,  1, 1, 0, 0, 0, 0, 0, 0 },
    { 14, 13, 13, 12, 12, 11, 10, 9,  8,  7,  7,  6,  6,  5,  5,  4,  3,  3,  2,  2,  2,  1, 1, 1, 0, 0, 0, 0, 0 },
    { 15, 14, 14, 13, 13, 11, 10, 9,  8,  7,  7,  7,  7,  6,  6,  5,  4,  4,  4,  3,  3,  2, 1, 1, 1, 0, 0, 0, 0 },
    { 15, 15, 15, 14, 14, 13, 12, 11, 10, 10, 10, 9,  8,  7,  6,  6,  5,  5,  4,  4,  4,  3, 2, 2, 1, 1, 0, 0, 0 },
    { 15, 15, 15, 15, 15, 14, 13, 12, 11, 11, 11, 10, 9,  8,  7,  6,  6,  6,  6,  5,  4,  4, 3, 2, 2, 2, 1, 1, 0 },
    { 16, 16, 16, 16, 16, 15, 14, 13, 12, 12, 12, 11, 10, 9,  9,  8,  7,  7,  6,  5,  5,  4, 3, 3, 2, 2, 2, 1, 1 },
    { 17, 17, 17, 16, 16, 15, 14, 14, 13, 13, 12, 12, 11, 11, 10, 9,  8,  8,  7,  6,  6,  5, 5, 3, 3, 2, 2, 1, 1 },
    { 18, 18, 17, 17, 17, 16, 15, 14, 13, 13, 13, 12, 12, 11, 11, 10, 9,  8,  8,  7,  6,  5, 5, 4, 3, 3, 2, 2, 1 },
    { 18, 18, 18, 17, 17, 16, 16, 15, 14, 14, 13, 13, 12, 12, 11, 10, 9,  9,  8,  8,  7,  6, 5, 4, 4, 3, 3, 2, 2 },
    { 19, 19, 18, 18, 17, 17, 16, 15, 15, 14, 14, 13, 13, 12, 11, 11, 10, 9,  9,  8,  8,  7, 6, 5, 4, 4, 3, 3, 2 },
    { 19, 19, 19, 18, 17, 17, 17, 16, 15, 15, 14, 13, 13, 12, 12, 11, 10, 9,  9,  8,  8,  7, 6, 5, 5, 4, 3, 3, 2 },
    { 21, 20, 20, 19, 18, 18, 17, 16, 16, 15, 14, 14, 13, 12, 12, 11, 10, 10, 9,  9,  8,  7, 7, 6, 5, 5, 4, 4, 3 },
    { 22, 21, 21, 20, 19, 19, 18, 17, 17, 16, 15, 15, 15, 14, 13, 13, 12, 11, 11, 11, 10, 9, 9, 8, 7, 7, 6, 6, 5 }
};

hi_u8 g_qlevel_luma_8bpc[NUM_16] = {0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 5, 6, 7};
hi_u8 g_qlevel_chroma_8bpc[NUM_16] = {0, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 8, 8, 8};
hi_u8 g_qlevel_luma_10bpc[NUM_20] = {0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 7, 8, 9};
hi_u8 g_qlevel_chroma_10bpc[NUM_20] = {0, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 10, 10, 10};
hi_u8 g_qlevel_luma_12bpc[NUM_24] = {0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 9, 10, 11};
hi_u8 g_qlevel_chroma_12bpc[NUM_24] = {0, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 12, 12, 12};
hi_u8 g_qlevel_luma_14bpc[NUM_28] = {
    0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 11, 12, 13
};
hi_u8 g_qlevel_chroma_14bpc[NUM_28] = {
    0, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 14, 14, 14
};
hi_u8 g_qlevel_luma_16bpc[NUM_32] = {
    0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, 13, 14, 15
};
hi_u8 g_qlevel_chroma_16bpc[NUM_32] = {
    0, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, 14, 14, 15, 16, 16, 16
};

struct dsc_cfg_s g_dsc_cfg_g;
struct para_input_s g_para_input_g;

static void HDMI_ERR_cfg(struct dsc_cfg_s *cfg)
{
    hi_u32 i = 0;

    HDMI_INFO("linebuf_depth          = %d\n", cfg->linebuf_depth);
    HDMI_INFO("rcb_bits              = %d\n", cfg->rcb_bits);
    HDMI_INFO("bits_per_component   = %d\n", cfg->bits_per_component);
    HDMI_INFO("convert_rgb          = %d\n", cfg->convert_rgb);
    HDMI_INFO("slice_width          = %d\n", cfg->slice_width);
    HDMI_INFO("slice_height          = %d\n", cfg->slice_height);
    HDMI_INFO("simple_422          = %d\n", cfg->simple_422);
    HDMI_INFO("native_422          = %d\n", cfg->native_422);
    HDMI_INFO("native_420          = %d\n", cfg->native_420);
    HDMI_INFO("native_444          = %d\n", cfg->native_444);
    HDMI_INFO("pic_width              = %d\n", cfg->pic_width);
    HDMI_INFO("pic_height          = %d\n", cfg->pic_height);
    HDMI_INFO("rc_tgt_offset_hi      = %d\n", cfg->rc_tgt_offset_hi);
    HDMI_INFO("rc_tgt_offset_lo      = %d\n", cfg->rc_tgt_offset_lo);
    HDMI_INFO("bits_per_pixel      = %d\n", cfg->bits_per_pixel);
    HDMI_INFO("rc_edge_factor      = %d\n", cfg->rc_edge_factor);
    HDMI_INFO("rc_quant_incr_limit0 = %d\n", cfg->rc_quant_incr_limit1);
    HDMI_INFO("rc_quant_incr_limit0 = %d\n", cfg->rc_quant_incr_limit0);
    HDMI_INFO("initial_xmit_delay   = %d\n", cfg->initial_xmit_delay);
    HDMI_INFO("initial_dec_delay      = %d\n", cfg->initial_dec_delay);
    HDMI_INFO("block_pred_enable      = %d\n", cfg->block_pred_enable);
    HDMI_INFO("first_line_bpg_ofs   = %d\n", cfg->first_line_bpg_ofs);
    HDMI_INFO("second_line_bpg_ofs  = %d\n", cfg->second_line_bpg_ofs);
    HDMI_INFO("initial_offset      = %d\n", cfg->initial_offset);
    HDMI_INFO("xstart              = %d\n", cfg->xstart);
    HDMI_INFO("ystart              = %d\n", cfg->ystart);
    for (i = 0; i < NUM_BUF_RANGES - 1; i++) {
        HDMI_INFO("rc_buf_thresh[%d]      = %d\n", i, cfg->rc_buf_thresh[i]);
    }
    for (i = 0; i < NUM_BUF_RANGES; i++) {
        HDMI_INFO("rc_range_parameters[%d].range_max_qp      = %d\n",
                  i, cfg->rc_range_parameters[i].range_max_qp);
        HDMI_INFO("rc_range_parameters[%d].range_min_qp      = %d\n",
                  i, cfg->rc_range_parameters[i].range_min_qp);
        HDMI_INFO("rc_range_parameters[%d].range_bpg_offset  = %.2x\n",
                  i, cfg->rc_range_parameters[i].range_bpg_offset);
    }
    HDMI_INFO("rc_model_size                              = %d\n", cfg->rc_model_size);
    HDMI_INFO("flatness_min_qp                          = %d\n", cfg->flatness_min_qp);
    HDMI_INFO("flatness_max_qp                          = %d\n", cfg->flatness_max_qp);
    HDMI_INFO("flatness_det_thresh                      = %d\n", cfg->flatness_det_thresh);
    HDMI_INFO("flatness_mod                              = %d\n", cfg->flatness_mod);
    HDMI_INFO("initial_scale_value                      = %d\n", cfg->initial_scale_value);
    HDMI_INFO("scale_decrement_interval                  = %d\n", cfg->scale_decrement_interval);
    HDMI_INFO("scale_increment_interval                  = %d\n", cfg->scale_increment_interval);
    HDMI_INFO("nfl_bpg_offset                          = %d\n", cfg->nfl_bpg_offset);
    HDMI_INFO("nsl_bpg_offset                          = %d\n", cfg->nsl_bpg_offset);
    HDMI_INFO("slice_bpg_offset                          = %d\n", cfg->slice_bpg_offset);
    HDMI_INFO("final_offset                              = %d\n", cfg->final_offset);
    HDMI_INFO("vbr_enable                              = %d\n", cfg->vbr_enable);
    HDMI_INFO("mux_word_size                              = %d\n", cfg->mux_word_size);
    HDMI_INFO("chunk_size                              = %d\n", cfg->chunk_size);
    HDMI_INFO("pps_identifier                          = %d\n", cfg->pps_identifier);
    HDMI_INFO("very_flat_qp                              = %d\n", cfg->very_flat_qp);
    HDMI_INFO("somewhat_flat_qp_delta                  = %d\n", cfg->somewhat_flat_qp_delta);
    HDMI_INFO("somewhat_flat_qp_thresh                  = %d\n", cfg->somewhat_flat_qp_thresh);
    HDMI_INFO("second_line_ofs_adj                      = %d\n", cfg->second_line_ofs_adj);
    HDMI_INFO("dsc_version_minor                          = %d\n", cfg->dsc_version_minor);
    HDMI_INFO("full_ich_err_precision                  = %d\n", cfg->full_ich_err_precision);
}

static hi_s32 dsc_cfg_qp2q_level(struct dsc_cfg_s *tc_cfg, hi_u8 qp, hi_u32 cpnt)
{
    hi_u8 qlevel = 0;

    if (((cpnt % NUM_3) == 0) || ((tc_cfg->native_420) && (cpnt == NUM_1))) {
        switch (tc_cfg->bits_per_component) {
            case NUM_8:
                qlevel = g_qlevel_luma_8bpc[qp];
                break;
            case NUM_10:
                qlevel = g_qlevel_luma_10bpc[qp];
                break;
            case NUM_12:
                qlevel = g_qlevel_luma_12bpc[qp];
                break;
            case NUM_14:
                qlevel = g_qlevel_luma_14bpc[qp];
                break;
            case NUM_16:
                qlevel = g_qlevel_luma_16bpc[qp];
                break;
            default:
                break;
        }
    } else {
        switch (tc_cfg->bits_per_component) {
            case NUM_8:
                qlevel = g_qlevel_chroma_8bpc[qp];
                break;
            case NUM_10:
                qlevel = g_qlevel_chroma_10bpc[qp];
                break;
            case NUM_12:
                qlevel = g_qlevel_chroma_12bpc[qp];
                break;
            case NUM_14:
                qlevel = g_qlevel_chroma_14bpc[qp];
                break;
            case NUM_16:
                qlevel = g_qlevel_chroma_16bpc[qp];
                break;
            default:
                break;
        }
        /* QP adjustment for YCbCr mode */
        if ((tc_cfg->dsc_version_minor == NUM_2) && !tc_cfg->convert_rgb) {
            qlevel = MAX(NUM_0, qlevel - NUM_1);
        }
    }

    return qlevel;
}

static void dsc_cfg_check_qp_for_overflow(struct dsc_cfg_s *tc_cfg,
    hi_u32 pixels_per_group, hi_u32 bits_per_pixel)
{
    hi_u32 min_target_bpg;
    hi_u32 p_mode_bits, max_bits;
    hi_u32 cpnt, max_res_size;
    hi_u32 cpnt_bit_depth[NUM_COMPONENTS];

    for (cpnt = 0; cpnt < NUM_COMPONENTS; ++cpnt) {
        cpnt_bit_depth[cpnt] =
            (tc_cfg->convert_rgb && (cpnt == NUM_1 || cpnt == NUM_2)) ?
            (tc_cfg->bits_per_component + NUM_1) : tc_cfg->bits_per_component;
    }

    min_target_bpg = pixels_per_group * bits_per_pixel -
                     BPP_FACTOR_16 * ((hi_u32)tc_cfg->slice_bpg_offset +
                     tc_cfg->nfl_bpg_offset) /
                     (1 << OFFSET_FRACTIONAL_BITS);

    /* MPP group when predicted size is 0 */
    p_mode_bits = NUM_1; /* extra bit for luma prefix/ICH switch */
    for (cpnt = 0; cpnt < (tc_cfg->native_422 ? NUM_4 : NUM_3); ++cpnt) {
        max_res_size = cpnt_bit_depth[cpnt] -
                       dsc_cfg_qp2q_level(tc_cfg,
                                          tc_cfg->rc_range_parameters[NUM_14].range_max_qp, cpnt);
        p_mode_bits += max_res_size * NUM_4; /* prefix + residuals */
    }

    /* Followed by predicted group (where predicted size is max size-1) */
    max_bits = p_mode_bits;
    p_mode_bits = NUM_1;
    for (cpnt = 0; cpnt < (tc_cfg->native_422 ? NUM_4 : NUM_3); ++cpnt) {
        max_res_size = cpnt_bit_depth[cpnt] -
                       dsc_cfg_qp2q_level(tc_cfg,
                                          tc_cfg->rc_range_parameters[NUM_14].range_max_qp, cpnt) - NUM_1;
        p_mode_bits += NUM_1 + max_res_size * NUM_3; /* prefix (1bit) + residuals */
    }
    max_bits += p_mode_bits;
    if (max_bits * BPP_FACTOR_16 > min_target_bpg * NUM_2) {
        HDMI_ERR("WARNING: RC model fullness");
    }
}

static hi_s32 dsc_cfg_compute_offset(struct dsc_cfg_s *tc_cfg, hi_u32 bits_per_pixel,
    hi_u32 pixels_per_group, hi_u32 groups_per_line, hi_u32 grpcnt)
{
    hi_u32 offset = 0;
    hi_u16 grpcnt_id;

    grpcnt_id = DIV_ROUND_UP(tc_cfg->initial_xmit_delay, pixels_per_group);
    if (grpcnt <= grpcnt_id) {
        offset =
            DIV_ROUND_UP(grpcnt * pixels_per_group * bits_per_pixel, NUM_16);
    } else {
        offset =
            DIV_ROUND_UP(grpcnt_id * pixels_per_group * bits_per_pixel, NUM_16) -
            (((grpcnt - grpcnt_id) * tc_cfg->slice_bpg_offset) >> OFFSET_FRACTIONAL_BITS);
    }

    if (grpcnt <= groups_per_line) {
        offset +=
            grpcnt * tc_cfg->first_line_bpg_ofs;
    } else {
        offset +=
            groups_per_line * tc_cfg->first_line_bpg_ofs -
            (((grpcnt - groups_per_line) * tc_cfg->nfl_bpg_offset) >> OFFSET_FRACTIONAL_BITS);
    }

    if (tc_cfg->native_420) {
        if (grpcnt <= groups_per_line) {
            offset -=
                (grpcnt * tc_cfg->nsl_bpg_offset) >> OFFSET_FRACTIONAL_BITS;
        } else if (grpcnt <= NUM_2 * groups_per_line) {
            offset +=
                (grpcnt - groups_per_line) * tc_cfg->second_line_bpg_ofs -
                ((groups_per_line * tc_cfg->nsl_bpg_offset) >>
                 OFFSET_FRACTIONAL_BITS);
        } else {
            offset +=
                (grpcnt - groups_per_line) * tc_cfg->second_line_bpg_ofs -
                (((grpcnt - groups_per_line) * tc_cfg->nsl_bpg_offset) >>
                 OFFSET_FRACTIONAL_BITS);
        }
    }
    return offset;
}

static hi_s32 dsc_cfg_compute_rc_parameters_single(struct dsc_cfg_s *tc_cfg)
{
    /* used for calculation */
    hi_u32 bits_per_pixel, final_scale;
    hi_u16 num_extra_mux_bits;
    hi_u32 pixels_per_group, slicew, groups_per_line;
    hi_u8 mux_word_size, num_ssps;
    hi_u32 slice_bits, groups_total, rbs_min, hrd_delay;
    hi_u8 in_valid = 0;
    hi_s32 max_offset;
    hi_u32 uncompressed_bpg_rate;
    hi_u32 tmp_scale_increment_interval;

    slicew = tc_cfg->slice_width >> (tc_cfg->native_422 || tc_cfg->native_420);
    bits_per_pixel = tc_cfg->bits_per_pixel;
    tc_cfg->initial_scale_value = BYTES * (hi_u32)tc_cfg->rc_model_size /
                                  (tc_cfg->rc_model_size - tc_cfg->initial_offset); /* recommended */

    if (tc_cfg->native_422) {
        uncompressed_bpg_rate = NUM_3 * tc_cfg->bits_per_component * NUM_4;
    } else {
        /* modified in version 20160923 */
        uncompressed_bpg_rate = (NUM_3 * tc_cfg->bits_per_component +
            (tc_cfg->convert_rgb ? NUM_2 : NUM_0)) * NUM_3;
    }

    if (tc_cfg->slice_height >= NUM_8) {
        tc_cfg->first_line_bpg_ofs =
            NUM_12 + NUM_9 * MIN(NUM_34, tc_cfg->slice_height - NUM_8) / NUM_100;
    } else {
        tc_cfg->first_line_bpg_ofs = NUM_2 * (tc_cfg->slice_height - NUM_1);
    }

    tc_cfg->first_line_bpg_ofs = CLAMP(tc_cfg->first_line_bpg_ofs, NUM_0,
                                       (NUM_16 * uncompressed_bpg_rate - NUM_3 *
                                       bits_per_pixel) / NUM_16);
    RANGE_CHECK("first_line_bpg_offset", tc_cfg->first_line_bpg_ofs, NUM_0, NUM_31);

    /* added in version 20160907 */
    tc_cfg->second_line_ofs_adj = tc_cfg->native_420 ? NUM_512 : NUM_0; /* added in version 20160923 */
    tc_cfg->second_line_bpg_ofs = tc_cfg->native_420 ? NUM_12 : NUM_0;  /* error in gc */
    tc_cfg->second_line_bpg_ofs = CLAMP(tc_cfg->second_line_bpg_ofs, NUM_0,
                                        (NUM_16 * uncompressed_bpg_rate - NUM_3 *
                                        bits_per_pixel) / NUM_16);
    RANGE_CHECK("second_line_bpg_offset", tc_cfg->second_line_bpg_ofs, NUM_0, NUM_31);

    pixels_per_group = NUM_3;
    groups_per_line = (slicew + pixels_per_group - NUM_1) / pixels_per_group;
    tc_cfg->chunk_size = DIV_ROUND_UP(slicew * bits_per_pixel, NUM_16 * NUM_8);
    RANGE_CHECK("chunk_size", tc_cfg->chunk_size, NUM_0, NUM_65535);

    mux_word_size = (tc_cfg->bits_per_component >= NUM_12) ? NUM_64 : NUM_48;
    tc_cfg->mux_word_size = mux_word_size;
    num_ssps = (tc_cfg->native_422) ? NUM_4 : NUM_3;

    if (tc_cfg->convert_rgb) {
        num_extra_mux_bits = (num_ssps * (mux_word_size +
                                          (NUM_4 * tc_cfg->bits_per_component + NUM_4) - NUM_2));
    } else if (!tc_cfg->native_422) { /* YCbCr */
        num_extra_mux_bits = (num_ssps * mux_word_size + (NUM_4 * tc_cfg->bits_per_component + NUM_4) +
            NUM_2 * (NUM_4 * tc_cfg->bits_per_component) - NUM_2);
    } else {
        num_extra_mux_bits = (num_ssps * mux_word_size + (NUM_4 * tc_cfg->bits_per_component + NUM_4) +
            NUM_3 * (NUM_4 * tc_cfg->bits_per_component) - NUM_2);
    }

    slice_bits = BYTES * (hi_u32)tc_cfg->chunk_size * tc_cfg->slice_height;
    while ((num_extra_mux_bits > NUM_0) &&
           ((slice_bits - num_extra_mux_bits) % mux_word_size)) {
        num_extra_mux_bits--;
    }

    if (groups_per_line < tc_cfg->initial_scale_value - NUM_8) {
        tc_cfg->initial_scale_value = groups_per_line + NUM_8;
    }

    if (tc_cfg->initial_scale_value > NUM_8) {
        tc_cfg->scale_decrement_interval =
            groups_per_line / (tc_cfg->initial_scale_value - NUM_8);
    } else {
        tc_cfg->scale_decrement_interval = NUM_4095;
    }

    RANGE_CHECK("scale_decrement_interval",
                tc_cfg->scale_decrement_interval, NUM_0, NUM_4095);

    tc_cfg->final_offset = tc_cfg->rc_model_size -
                           (((hi_u32)tc_cfg->initial_xmit_delay *
                           tc_cfg->bits_per_pixel + BYTES) >> NUM_4) +
                           num_extra_mux_bits;

    RANGE_CHECK("final_offset", tc_cfg->final_offset, NUM_0, NUM_65535);
    if (tc_cfg->final_offset >= tc_cfg->rc_model_size) {
        HDMI_ERR("ERROR: The final_offset must be less than the rc_model_size.\n");
    }

    final_scale = BYTES * (hi_u32)tc_cfg->rc_model_size /
                  (tc_cfg->rc_model_size - tc_cfg->final_offset);
    if (final_scale > NUM_63) {
        HDMI_ERR("WARNING: A final scale value may have undefined behavior.\n");
    }

    if (tc_cfg->slice_height > NUM_1) {
        tc_cfg->nfl_bpg_offset =
            DIV_ROUND_UP((hi_u32)tc_cfg->first_line_bpg_ofs <<
                         OFFSET_FRACTIONAL_BITS,
                         tc_cfg->slice_height - NUM_1);
    } else {
        tc_cfg->nfl_bpg_offset = NUM_0;
    }

    if (tc_cfg->nfl_bpg_offset > NUM_65535) {
        HDMI_ERR("Error: nfl_bpg_offset is too large for this slice height\n");
        in_valid = NUM_1;
    }

    if (tc_cfg->slice_height > NUM_2) {
        tc_cfg->nsl_bpg_offset =
            DIV_ROUND_UP((hi_u32)tc_cfg->second_line_bpg_ofs <<
                         OFFSET_FRACTIONAL_BITS,
                         tc_cfg->slice_height - NUM_1);
    } else {
        tc_cfg->nsl_bpg_offset = NUM_0;
    }

    if (tc_cfg->nsl_bpg_offset > NUM_65535) {
        HDMI_ERR("Error: nsl_bpg_offset is too large for this slice height\n");
        in_valid = NUM_1;
    }

    groups_total = groups_per_line * tc_cfg->slice_height;
    tc_cfg->slice_bpg_offset =
        DIV_ROUND_UP((1 << OFFSET_FRACTIONAL_BITS) *
                     (hi_u32)(tc_cfg->rc_model_size - tc_cfg->initial_offset +
                     num_extra_mux_bits), groups_total);
    RANGE_CHECK("slice_bpg_offset", tc_cfg->slice_bpg_offset, NUM_0, NUM_65535);

    if (tc_cfg->slice_height == NUM_1) {
        if (tc_cfg->first_line_bpg_ofs > NUM_0) {
            HDMI_ERR("For slice_height == 1, the FIRST_LINE_BPG_OFFSET must be 0.\n");
        }
    } else if (pixels_per_group * bits_per_pixel -
               BPP_FACTOR_16 * ((hi_u32)tc_cfg->slice_bpg_offset + tc_cfg->nfl_bpg_offset) /
               (1 << OFFSET_FRACTIONAL_BITS) < (NUM_1 + NUM_5 * pixels_per_group) * NUM_16) {
        HDMI_ERR("ERROR: The bits/pixel allocation is too low (<5.33bpp).\n");
    }

    /* BEGIN scale_increment_interval fix */
    if (final_scale > MAX_FINAL_SCALE) {
        /****************************************************************
		 *  Note: the following calculation assumes that the rcXformOffset crosses 0 at some point.
		 *  If the zero-crossing doesn't occur in a configuration, we recommend to reconfigure the
		 *   rc_model_size and thresholds to be smaller for that configuration.
		 *
		 */
        tmp_scale_increment_interval = ((hi_u32)tc_cfg->final_offset *
                                            (1 << OFFSET_FRACTIONAL_BITS)) /
                                            ((final_scale - MAX_FINAL_SCALE) *
                                            (tc_cfg->nfl_bpg_offset +
                                            tc_cfg->slice_bpg_offset +
                                            tc_cfg->nsl_bpg_offset));

        tc_cfg->scale_increment_interval = (hi_u16)tmp_scale_increment_interval;
        if (tmp_scale_increment_interval > MAX_SCALE_INCREMENT_INTERVAL) {
            HDMI_ERR("Error: scale_increment_interval is too large.\n");
            in_valid = 1;
        }
    } else {
        tc_cfg->scale_increment_interval = 0;
    }

    /* END scale_increment_interval fix */
    if (tc_cfg->dsc_version_minor == NUM_2 &&
        (tc_cfg->native_420 || tc_cfg->native_422)) {
        /* OPTIMIZED computation of rbs_min: */
        /* Compute max by sampling offset at points of inflection */
        /* MODEL NOTE* MN_RBS_MIN */
        max_offset =
            dsc_cfg_compute_offset(tc_cfg, bits_per_pixel, pixels_per_group,
                                   groups_per_line, DIV_ROUND_UP(tc_cfg->initial_xmit_delay, pixels_per_group));
        max_offset = MAX(max_offset,
                         dsc_cfg_compute_offset(tc_cfg, bits_per_pixel,
                                                pixels_per_group, groups_per_line, groups_per_line));
        max_offset = MAX(max_offset,
                         dsc_cfg_compute_offset(tc_cfg, bits_per_pixel,
                                                pixels_per_group, groups_per_line, NUM_2 * groups_per_line));
        rbs_min = tc_cfg->rc_model_size - tc_cfg->initial_offset + max_offset;
    } else { /* DSC 1.1 method */
        rbs_min = tc_cfg->rc_model_size - tc_cfg->initial_offset +
                  DIV_ROUND_UP(tc_cfg->initial_xmit_delay * bits_per_pixel, NUM_16) +
                  groups_per_line * tc_cfg->first_line_bpg_ofs;
    }

    hrd_delay = DIV_ROUND_UP(rbs_min * NUM_16, bits_per_pixel);
    tc_cfg->rcb_bits = DIV_ROUND_UP(hrd_delay * bits_per_pixel, NUM_16);
    tc_cfg->initial_dec_delay = hrd_delay - tc_cfg->initial_xmit_delay;
    RANGE_CHECK("initial_dec_delay", tc_cfg->initial_dec_delay, NUM_0, NUM_65535);

    dsc_cfg_check_qp_for_overflow(tc_cfg, pixels_per_group, bits_per_pixel);

    return in_valid;
}

static void dsc_cfg_compute_rc_parameters(struct dsc_cfg_s *tc_cfg)
{
    hi_u16 pic_height_padding;

    if (!tc_cfg->slice_height) {
        tc_cfg->slice_height = tc_cfg->pic_height;
        while (dsc_cfg_compute_rc_parameters_single(tc_cfg)) {
            tc_cfg->slice_height = (tc_cfg->slice_height + 1) >> 1;
            if (tc_cfg->native_420) {
                tc_cfg->slice_height = tc_cfg->slice_height +
                                       (tc_cfg->slice_height & 1);
            }
        }
    } else {
        dsc_cfg_compute_rc_parameters_single(tc_cfg);
    }

    if (tc_cfg->slice_height != 0) {
        pic_height_padding = (tc_cfg->pic_height + tc_cfg->slice_height - 1) /
                             tc_cfg->slice_height * tc_cfg->slice_height;
    }
}

static void dsc_cfg_set_parameters_444_or_rgb(struct dsc_cfg_s *tc_cfg)
{
    hi_u8 i;
    hi_u32 cbpp;
    hi_u8 bpc;
    hi_u16 tmp_cbpp;
    hi_u16 index;

    cbpp = tc_cfg->bits_per_pixel;
    bpc = tc_cfg->bits_per_component;

    if (tc_cfg->bits_per_component == NUM_8) {
        tc_cfg->rc_quant_incr_limit1 = NUM_11;
        tc_cfg->rc_quant_incr_limit0 = NUM_11;
        tc_cfg->flatness_min_qp = NUM_3;
        tc_cfg->flatness_max_qp = NUM_12;
    } else if (tc_cfg->bits_per_component == NUM_10) {
        tc_cfg->rc_quant_incr_limit1 = NUM_15;
        tc_cfg->rc_quant_incr_limit0 = NUM_15;
        tc_cfg->flatness_min_qp = NUM_7;
        tc_cfg->flatness_max_qp = NUM_16;
    } else if (tc_cfg->bits_per_component == NUM_12) {
        tc_cfg->rc_quant_incr_limit1 = NUM_19;
        tc_cfg->rc_quant_incr_limit0 = NUM_19;
        tc_cfg->flatness_min_qp = NUM_11;
        tc_cfg->flatness_max_qp = NUM_20;
    } else {
        tc_cfg->rc_quant_incr_limit1 = NUM_15;
        tc_cfg->rc_quant_incr_limit0 = NUM_15;
        tc_cfg->flatness_min_qp = NUM_7;
        tc_cfg->flatness_max_qp = NUM_16;
    }

    if (cbpp >= NUM_192) {
        tc_cfg->initial_offset = NUM_2048;
    } else if (cbpp <= NUM_128) {
        tc_cfg->initial_offset = NUM_6144;
    } else if (cbpp <= NUM_160) {
        tc_cfg->initial_offset = NUM_6144 -
                                 DIV_ROUND_CLOSEST((cbpp - NUM_128) * NUM_512,
                                                   NUM_16 * NUM_2);
    } else if (cbpp < NUM_192) {
        tc_cfg->initial_offset = NUM_5632 -
                                 DIV_ROUND_CLOSEST((cbpp - NUM_160) * NUM_3584,
                                                   NUM_16 * NUM_2);
    }

    tc_cfg->initial_xmit_delay =
        ((hi_u32)tc_cfg->rc_model_size * BPP_FACTOR_16  + cbpp) /
        (cbpp * NUM_2);
    tc_cfg->flatness_det_thresh = NUM_2 <<
                                  (tc_cfg->bits_per_component - BYTES);

    if (cbpp <= NUM_96) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_bpg_offset =
                g_range_bpg_offset_bppmin_444[i];
        }
    } else if (cbpp < NUM_128) {
        for (i = 0; i < NUM_5; i++) {
            tc_cfg->rc_range_parameters[i].range_bpg_offset =
                (g_range_bpg_offset_bppmin_444[i] +
                 DIV_ROUND_CLOSEST((cbpp - NUM_96), NUM_16));
        }

        for (i = NUM_5; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_bpg_offset =
                g_range_bpg_offset_bppmin_444[i];
        }
    } else if (cbpp <= NUM_192) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_bpg_offset =
                g_range_bpg_offset_bppmin[i];
        }
    } else if (cbpp < NUM_240) {
        tc_cfg->rc_range_parameters[NUM_0].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_0] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_8, NUM_16 * NUM_3);
        tc_cfg->rc_range_parameters[NUM_1].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_1] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_8, NUM_16 * NUM_3);
        tc_cfg->rc_range_parameters[NUM_2].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_2] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_6, NUM_16 * NUM_3);
        tc_cfg->rc_range_parameters[NUM_3].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_3] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_6, NUM_16 * NUM_3);
        tc_cfg->rc_range_parameters[NUM_4].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_4] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_6, NUM_16 * NUM_3);
        tc_cfg->rc_range_parameters[NUM_5].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_5] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_6, NUM_16 * NUM_3);
        tc_cfg->rc_range_parameters[NUM_6].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_6] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_6, NUM_16 * NUM_3);
        tc_cfg->rc_range_parameters[NUM_7].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_7] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_4, NUM_16 * NUM_3);
        tc_cfg->rc_range_parameters[NUM_8].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_8] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_2, NUM_16 * NUM_3);
        tc_cfg->rc_range_parameters[NUM_9].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_9] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_2, NUM_16 * NUM_3);
        tc_cfg->rc_range_parameters[NUM_10].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_10];
        tc_cfg->rc_range_parameters[NUM_12].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_12];
        tc_cfg->rc_range_parameters[NUM_13].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_13];
        tc_cfg->rc_range_parameters[NUM_14].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_14];
    } else if (cbpp >= NUM_240) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_bpg_offset =
                g_range_bpg_offset_bppmax[i];
        }
    }

    if (cbpp <= NUM_96) {
        tc_cfg->rc_range_parameters[NUM_11].range_bpg_offset =
            g_range_bpg_offset_bppmin_444[NUM_11];
    } else if (cbpp < NUM_128) {
        tc_cfg->rc_range_parameters[NUM_11].range_bpg_offset =
            g_range_bpg_offset_bppmin_444[NUM_11] +
            DIV_ROUND_CLOSEST((cbpp - NUM_96), NUM_16);
    } else if (cbpp >= NUM_128) {
        tc_cfg->rc_range_parameters[NUM_11].range_bpg_offset =
            g_range_bpg_offset_bppmax[NUM_11];
    }

    /* Range BPG Offset is only a 6 bits. */
    for (i = 0; i < NUM_BUF_RANGES; i++) {
        tc_cfg->rc_range_parameters[i].range_bpg_offset &= RANGE_BPG_OFFSET_MASK;
    }

    /* if (cbpp/16)*2 is not an interger */
    tmp_cbpp = DIV_ROUND_CLOSEST(cbpp * NUM_2, NUM_16);

    index = tmp_cbpp - NUM_12;

    if (bpc == NUM_8) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_min_qp =
                g_range_min_qp_8bpc_444_or_rgb[i][index];
            tc_cfg->rc_range_parameters[i].range_max_qp =
                g_range_max_qp_8bpc_444_or_rgb[i][index];
        }
    } else if (bpc == NUM_10) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_min_qp =
                g_range_min_qp_10bpc_444_or_rgb[i][index];
            tc_cfg->rc_range_parameters[i].range_max_qp =
                g_range_max_qp_10bpc_444_or_rgb[i][index];
        }
    } else {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_min_qp =
                g_range_min_qp_12bpc_444_or_rgb[i][index];
            tc_cfg->rc_range_parameters[i].range_max_qp =
                g_range_max_qp_12bpc_444_or_rgb[i][index];
        }
    }
}

static void dsc_cfg_set_parameters_422(struct dsc_cfg_s *tc_cfg)
{
    hi_u8 i;
    hi_u32 cbpp;
    hi_u8 bpc;
    hi_u16 tmp_cbpp;
    hi_u16 index;

    cbpp = tc_cfg->bits_per_pixel;
    bpc = tc_cfg->bits_per_component;
    if (tc_cfg->bits_per_component == NUM_8) {
        tc_cfg->rc_quant_incr_limit1 = NUM_11;
        tc_cfg->rc_quant_incr_limit0 = NUM_11;
        tc_cfg->flatness_min_qp = NUM_3;
        tc_cfg->flatness_max_qp = NUM_12;
    } else if (tc_cfg->bits_per_component == NUM_10) {
        tc_cfg->rc_quant_incr_limit1 = NUM_15;
        tc_cfg->rc_quant_incr_limit0 = NUM_15;
        tc_cfg->flatness_min_qp = NUM_7;
        tc_cfg->flatness_max_qp = NUM_16;
    } else if (tc_cfg->bits_per_component == NUM_12) {
        tc_cfg->rc_quant_incr_limit1 = NUM_19;
        tc_cfg->rc_quant_incr_limit0 = NUM_19;
        tc_cfg->flatness_min_qp = NUM_11;
        tc_cfg->flatness_max_qp = NUM_20;
    } else {
        tc_cfg->rc_quant_incr_limit1 = NUM_15;
        tc_cfg->rc_quant_incr_limit0 = NUM_15;
        tc_cfg->flatness_min_qp = NUM_7;
        tc_cfg->flatness_max_qp = NUM_16;
    }

    if (cbpp >= NUM_256) {
        tc_cfg->initial_offset = NUM_2048;
    } else if (cbpp <= NUM_224) {
        tc_cfg->initial_offset = NUM_5632;
    } else {
        tc_cfg->initial_offset = NUM_5632 -
                                 DIV_ROUND_CLOSEST((cbpp - NUM_224) * NUM_3584,
                                                   NUM_32);
    }

    tc_cfg->initial_xmit_delay =
        ((hi_u32)tc_cfg->rc_model_size * NUM_16  + cbpp) / (cbpp * NUM_2);
    tc_cfg->flatness_det_thresh = NUM_2 << (tc_cfg->bits_per_component - NUM_8);
    if (cbpp <= NUM_256) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_bpg_offset =
                g_range_bpg_offset_bppmin[i];
        }
    } else if (cbpp < NUM_320) {
        tc_cfg->rc_range_parameters[NUM_0].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_0] +
            DIV_ROUND_CLOSEST((cbpp - NUM_256) * NUM_8, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_1].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_1] +
            DIV_ROUND_CLOSEST((cbpp - NUM_256) * NUM_8, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_2].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_2] +
            DIV_ROUND_CLOSEST((cbpp - NUM_256) * NUM_6, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_3].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_3] +
            DIV_ROUND_CLOSEST((cbpp - NUM_256) * NUM_6, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_4].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_4] +
            DIV_ROUND_CLOSEST((cbpp - NUM_256) * NUM_6, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_5].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_5] +
            DIV_ROUND_CLOSEST((cbpp - NUM_256) * NUM_6, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_6].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_6] +
            DIV_ROUND_CLOSEST((cbpp - NUM_256) * NUM_6, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_7].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_7] +
            DIV_ROUND_CLOSEST((cbpp - NUM_256) * NUM_4, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_8].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_8] +
            DIV_ROUND_CLOSEST((cbpp - NUM_256) * NUM_2, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_9].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_9] +
            DIV_ROUND_CLOSEST((cbpp - NUM_256) * NUM_2, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_10].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_10];
        tc_cfg->rc_range_parameters[NUM_12].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_12];
        tc_cfg->rc_range_parameters[NUM_13].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_13];
        tc_cfg->rc_range_parameters[NUM_14].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_14];
    } else if (cbpp >= NUM_320) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_bpg_offset =
                g_range_bpg_offset_bppmax[i];
        }
    }

    if (cbpp <= NUM_192) {
        tc_cfg->rc_range_parameters[NUM_11].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_11];
    } else if (cbpp < NUM_256) {
        tc_cfg->rc_range_parameters[NUM_11].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_11] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_2, NUM_32 * NUM_2);
    } else if (cbpp >= NUM_256) {
        tc_cfg->rc_range_parameters[NUM_11].range_bpg_offset =
            g_range_bpg_offset_bppmax[NUM_11];
    }

    /* Range BPG Offset is only a 6 bits. */
    for (i = 0; i < NUM_BUF_RANGES; i++) {
        tc_cfg->rc_range_parameters[i].range_bpg_offset &= RANGE_BPG_OFFSET_MASK;
    }

    /* if (cbpp/32)*2 is not an interger */
    tmp_cbpp = DIV_ROUND_CLOSEST(cbpp * NUM_2, NUM_32);

    index = tmp_cbpp - NUM_12;

    if (bpc == NUM_8) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_min_qp =
                g_range_min_qp_8bpc_422[i][index];
            tc_cfg->rc_range_parameters[i].range_max_qp =
                g_range_max_qp_8bpc_422[i][index];
        }
    } else if (bpc == NUM_10) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_min_qp =
                g_range_min_qp_10bpc_422[i][index];
            tc_cfg->rc_range_parameters[i].range_max_qp =
                g_range_max_qp_10bpc_422[i][index];
        }
    } else {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_min_qp =
                g_range_min_qp_12bpc_422[i][index];
            tc_cfg->rc_range_parameters[i].range_max_qp =
                g_range_max_qp_12bpc_422[i][index];
        }
    }
}

static void dsc_cfg_set_parameters_420(struct dsc_cfg_s *tc_cfg)
{
    hi_u8 i = 0;
    hi_u32 cbpp;
    hi_u8 bpc;
    hi_u16 tmp_cbpp;
    hi_u16 index;

    cbpp = tc_cfg->bits_per_pixel;
    bpc = tc_cfg->bits_per_component;
    if (tc_cfg->bits_per_component == NUM_8) {
        tc_cfg->rc_quant_incr_limit1 = NUM_11;
        tc_cfg->rc_quant_incr_limit0 = NUM_11;
        tc_cfg->flatness_min_qp = NUM_3;
        tc_cfg->flatness_max_qp = NUM_12;
    } else if (tc_cfg->bits_per_component == NUM_10) {
        tc_cfg->rc_quant_incr_limit1 = NUM_15;
        tc_cfg->rc_quant_incr_limit0 = NUM_15;
        tc_cfg->flatness_min_qp = NUM_7;
        tc_cfg->flatness_max_qp = NUM_16;
    } else if (tc_cfg->bits_per_component == NUM_12) {
        tc_cfg->rc_quant_incr_limit1 = NUM_19;
        tc_cfg->rc_quant_incr_limit0 = NUM_19;
        tc_cfg->flatness_min_qp = NUM_11;
        tc_cfg->flatness_max_qp = NUM_20;
    } else {
        tc_cfg->rc_quant_incr_limit1 = NUM_15;
        tc_cfg->rc_quant_incr_limit0 = NUM_15;
        tc_cfg->flatness_min_qp = NUM_7;
        tc_cfg->flatness_max_qp = NUM_16;
    }

    if (cbpp >= NUM_192) {
        tc_cfg->initial_offset = NUM_2048;
    } else if (cbpp <= NUM_128) {
        tc_cfg->initial_offset = NUM_6144;
    } else if (cbpp <= NUM_160) {
        tc_cfg->initial_offset = NUM_6144 -
                                 DIV_ROUND_CLOSEST((cbpp - NUM_128) * NUM_512,
                                                   NUM_32);
    } else {
        tc_cfg->initial_offset = NUM_5632 -
                                 DIV_ROUND_CLOSEST((cbpp - NUM_160) * NUM_3584,
                                                   NUM_32);
    }

    tc_cfg->initial_xmit_delay = (hi_u32)tc_cfg->rc_model_size * NUM_8 / cbpp;
    tc_cfg->flatness_det_thresh = NUM_2 << (tc_cfg->bits_per_component - NUM_8);
    if (cbpp <= NUM_192) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_bpg_offset =
                g_range_bpg_offset_bppmin[i];
        }
    } else if (cbpp < NUM_256) {
        tc_cfg->rc_range_parameters[NUM_0].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_0] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_8, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_1].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_1] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_8, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_2].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_2] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_6, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_3].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_3] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_6, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_4].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_4] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_6, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_5].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_5] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_6, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_6].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_6] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_6, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_7].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_7] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_4, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_8].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_8] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_2, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_9].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_9] +
            DIV_ROUND_CLOSEST((cbpp - NUM_192) * NUM_2, NUM_32 * NUM_2);
        tc_cfg->rc_range_parameters[NUM_10].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_10];
        tc_cfg->rc_range_parameters[NUM_12].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_12];
        tc_cfg->rc_range_parameters[NUM_13].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_13];
        tc_cfg->rc_range_parameters[NUM_14].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_14];
    } else if (cbpp >= NUM_256) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_bpg_offset =
                g_range_bpg_offset_bppmax[i];
        }
    }

    if (cbpp <= NUM_128) {
        tc_cfg->rc_range_parameters[NUM_11].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_11];
    } else if (cbpp < NUM_160) {
        tc_cfg->rc_range_parameters[NUM_11].range_bpg_offset =
            g_range_bpg_offset_bppmin[NUM_11] +
            DIV_ROUND_CLOSEST((cbpp - NUM_128) * NUM_2, NUM_32);
    } else if (cbpp >= NUM_160) {
        tc_cfg->rc_range_parameters[NUM_11].range_bpg_offset =
            g_range_bpg_offset_bppmax[NUM_11];
    }

    /* Range BPG Offset is only a 6 bits. */
    for (i = 0; i < NUM_BUF_RANGES; i++) {
        tc_cfg->rc_range_parameters[i].range_bpg_offset &= RANGE_BPG_OFFSET_MASK;
    }

    /* if (cbpp/32)*2 is not an interger */
    tmp_cbpp = DIV_ROUND_CLOSEST(cbpp * NUM_2, NUM_32);

    index = tmp_cbpp - NUM_8;

    if (bpc == NUM_8) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_min_qp =
                g_range_min_qp_8bpc_420[i][index];
            tc_cfg->rc_range_parameters[i].range_max_qp =
                g_range_max_qp_8bpc_420[i][index];
        }
    } else if (bpc == NUM_10) {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_min_qp =
                g_range_min_qp_10bpc_420[i][index];
            tc_cfg->rc_range_parameters[i].range_max_qp =
                g_range_max_qp_10bpc_420[i][index];
        }
    } else {
        for (i = 0; i < NUM_BUF_RANGES; i++) {
            tc_cfg->rc_range_parameters[i].range_min_qp =
                g_range_min_qp_12bpc_420[i][index];
            tc_cfg->rc_range_parameters[i].range_max_qp =
                g_range_max_qp_12bpc_420[i][index];
        }
    }
}

static void dsc_cfg_set_basic_parameters(struct dsc_cfg_s *tc_cfg)
{
    tc_cfg->linebuf_depth = NUM_13;
    tc_cfg->block_pred_enable = NUM_1;
    tc_cfg->xstart = NUM_0;
    tc_cfg->ystart = NUM_0;
    tc_cfg->flatness_mod = NUM_0;
    tc_cfg->vbr_enable = NUM_0;
    tc_cfg->pps_identifier = NUM_0;
    tc_cfg->dsc_version_minor = NUM_2;
    tc_cfg->simple_422 = NUM_0;
    tc_cfg->rc_model_size = NUM_8192;
    tc_cfg->rc_edge_factor = NUM_6;
    tc_cfg->rc_tgt_offset_lo = NUM_3;
    tc_cfg->rc_tgt_offset_hi = NUM_3;
    tc_cfg->full_ich_err_precision = NUM_1;
    tc_cfg->rc_buf_thresh[NUM_0] = NUM_896 / LSB;
    tc_cfg->rc_buf_thresh[NUM_1] = NUM_1792 / LSB;
    tc_cfg->rc_buf_thresh[NUM_2] = NUM_2688 / LSB;
    tc_cfg->rc_buf_thresh[NUM_3] = NUM_3584 / LSB;
    tc_cfg->rc_buf_thresh[NUM_4] = NUM_4480 / LSB;
    tc_cfg->rc_buf_thresh[NUM_5] = NUM_5376 / LSB;
    tc_cfg->rc_buf_thresh[NUM_6] = NUM_6272 / LSB;
    tc_cfg->rc_buf_thresh[NUM_7] = NUM_6720 / LSB;
    tc_cfg->rc_buf_thresh[NUM_8] = NUM_7168 / LSB;
    tc_cfg->rc_buf_thresh[NUM_9] = NUM_7616 / LSB;
    tc_cfg->rc_buf_thresh[NUM_10] = NUM_7744 / LSB;
    tc_cfg->rc_buf_thresh[NUM_11] = NUM_7872 / LSB;
    tc_cfg->rc_buf_thresh[NUM_12] = NUM_8000 / LSB;
    tc_cfg->rc_buf_thresh[NUM_13] = NUM_8064 / LSB;
    tc_cfg->second_line_bpg_ofs = NUM_0;
    tc_cfg->second_line_ofs_adj = NUM_0;

    if (tc_cfg->native_420) {
        dsc_cfg_set_parameters_420(tc_cfg);
    } else if (tc_cfg->native_422) {
        dsc_cfg_set_parameters_422(tc_cfg);
    } else {
        dsc_cfg_set_parameters_444_or_rgb(tc_cfg);
    }

    tc_cfg->very_flat_qp = NUM_1 +
                           (NUM_2 * (tc_cfg->bits_per_component - NUM_8));
    tc_cfg->somewhat_flat_qp_delta = NUM_4;
    tc_cfg->somewhat_flat_qp_thresh = NUM_7 + (NUM_2 *
                                      (tc_cfg->bits_per_component - NUM_8));
}

void hi_dsc_cfg_compute(struct para_input_s *para_input,
                        struct dsc_cfg_s *tc_cfg)
{
    tc_cfg->convert_rgb = para_input->convert_rgb;
    tc_cfg->native_420 = para_input->native_420;
    tc_cfg->native_422 = para_input->native_422;
    tc_cfg->native_444 = para_input->native_444;
    tc_cfg->bits_per_component = para_input->bits_per_component;
    tc_cfg->bits_per_pixel = para_input->bits_per_pixel;
    tc_cfg->pic_width = para_input->pic_width;
    tc_cfg->pic_height = para_input->pic_height;
    tc_cfg->slice_width = para_input->slice_width;
    tc_cfg->slice_height = para_input->slice_height;

    dsc_cfg_set_basic_parameters(tc_cfg);
    dsc_cfg_compute_rc_parameters(tc_cfg);
    HDMI_ERR_cfg(tc_cfg);
}

